#!/usr/bin/perl
use warnings;
use strict;
use File::Basename;

my $me = dirname $0;
open(my $f, '<', $ARGV[0]);
while (<$f>) {
  foreach my $m (/'~\/(.*?)'/) {
    my $f = "${ENV{'HOME'}}/$1";
    next if -e $f;
    my $dir = dirname $f;
    print "Regenerating $dir\n";
    `"$me/mp-analyze" "$dir"`;
  }
}
